<!DOCTYPE html>
<html>
    <head>
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src="js/moment.js"></script>
        <script src="js/bootstrap.js"></script>
        <script src="js/bootstrap-datetimepicker.js"></script>
        <script src="js/bootbox.min.js"></script>
        <script src="js/placeholder.js"></script>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/myStyle.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-datetimepicker.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-arrow-buttons.css">
    </head>
    <body>
        <div id="wrap">
            <!-- Top menu bar begins -->
            <div class='navbar navbar-default navbar-static-top'>
                <div class="container">
                    <!-- Logo begins -->
                    <a href='#' class='navbar-brand'>
                        <text style="color:rgb(44,164,176)">
                            Ne</text><text style="color:red">x</text><text style="color:rgb(44,164,176)">peria DMAN Golf Society
                        </text>
                    </a>
                    <!-- Logo ends -->
                    <ul class="nav nav-pills navbar-right"> 
                        <!-- Log in menu begins -->
                        <li id="login-menu">
                            <a href="#"  data-toggle="dropdown">Log in<span class="caret"></span></a>
                            <ul id="login-dp" class="dropdown-menu">
                                <li>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <form class="form" role="form" method="post" action="login" accept-charset="UTF-8" id="login-nav">
                                                <div class="form-group">
                                                    <label class="sr-only" for="loginUsername">
                                                        Username
                                                    </label>
                                                    <input type="text" class="form-control" id="loginUsername" placeholder="Username" required>
                                                </div>
                                                <div class="form-group">
                                                    <label class="sr-only" for="loginPassword">
                                                        Password
                                                    </label>
                                                        <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
                                                        <div class="help-block text-right">
                                                            <a href="">
                                                                 Forget the password ?
                                                            </a>
                                                        </div>
                                                </div>
                                                <div class="form-group">
                                                    <button id="loginbtn" type="button" class="btn btn-primary btn-block">
                                                        Sign in
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <!-- Log in menu ends -->
                        
                        <!-- Logged user menu begins -->
                        <li id="loggedin" style="display:none">
                            <a href="#" data-toggle="dropdown">
                                <span class="text" id="userMenuTitle">
                                    User
                                </span>
                                <span class="caret">
                                </span>
                            </a>
                            <ul id="userMenu" class="dropdown-menu">
                                <li>
                                    <a href="#accountsettings" id="accountsettingsLink">
                                        <span class="glyphicon glyphicon-cog pull-right">
                                        </span>
                                        <span class="dropdown-link-text" style="margin-right:40px">
                                            Account Settings
                                        </span>
                                    </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#userstats" id="userstatsLink">
                                        <span class="glyphicon glyphicon-stats pull-right">
                                        </span>
                                        <span class="dropdown-link-text">
                                            User stats 
                                        </span>
                                    </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#" id="logoutLink">
                                        <span class="glyphicon glyphicon-log-out pull-right">
                                        </span>
                                        <span class="dropdown-link-text">
                                            Log Out 
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <!-- Logged user menu ends -->
                        <li>
                            <a href="#contact">
                                Contact
                            </a>
                        </li>
                    </ul>
                </div>
            </div>   
            <!-- Top menu bar ends -->

        <!-- Carousel begins -->
            <!-- Header Carousel, looped photos at top of the screen -->
            <header id="myCarousel" class="carousel slide" data-interval="10000" data-ride="carousel">
                
                <!-- Indicators , carousel skeleton-->
                <ol class="carousel-indicators">
                    <li data-target="#myCarousel" data-slide-to="0" class='active'></li>
                    <li data-target="#myCarousel" data-slide-to="1"></li>
                    <li data-target="#myCarousel" data-slide-to="2"></li>
                    <li data-target="#myCarousel" data-slide-to="3"></li>
                    <li data-target="#myCarousel" data-slide-to="4"></li>
                    <li data-target="#myCarousel" data-slide-to="5"></li>
                </ol>
                
                <!-- Wrapper for slides -->
                <div class="carousel-inner">
                    <div class="item active">
                        <img src="img/s1.png">
                        <div class="carousel-caption">
                            <h1></h1>
                        </div>
                    </div>

                    <div class="item">
                        <img src="img/s2.png">
                        <div class="carousel-caption">
                            <h1></h1>
                        </div>
                    </div>

                    <div class="item">
                        <img src="img/s3.png">
                        <div class="carousel-caption">
                            <h1></h1>
                        </div>
                    </div>

                    <div class="item">
                        <img src="img/s4.png">
                        <div class="carousel-caption">
                            <h1></h1>
                        </div>
                    </div>

                    <div class="item">
                        <img src="img/s5.png">
                        <div class="carousel-caption">
                            <h1></h1>
                        </div>
                    </div>
                    
                    <div class="item">
                        <img src="img/s6.png">
                        <div class="carousel-caption">
                            <h1></h1>
                        </div>
                    </div>
                    
                    <!-- Controls -->
                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                        <span class="icon-prev"></span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel" data-slide="next">
                        <span class="icon-next"></span>
                    </a>
                </div>
            </header>
        <!-- Carousel ends -->
            
            <div class="container ">
                <div class="row" style="margin-top: 50px">
                    <div  class="col-md-3 text-center" style="float:left">
                        <ul class="list-group well" id="glofmenu">
                            <!-- Menu with general access begins -->
                            <li class="list-group-item" id="membershiplisting">
                                <a class="notop" href="javascript:void(0)">
                                    Membership
                                </a>
                            </li>
                            <li class="list-group-item" id="committee">
                                <a class="notop" href="javascript:void(0)">
                                    The Committee
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a class="notop" href="javascript:void(0)">
                                    Society Constitution
                                </a>
                            </li>
                            <li class="list-group-item" id="societyeventslisting">
                                <a class="notop" href="javascript:void(0)">
                                    Society Events
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a class="notop" href="javascript:void(0)">
                                    Competition Results
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a class="notop" href="javascript:void(0)">
                                    Player of the Year
                                </a>
                            </li>
                        <!-- Menu with general access ends -->
                        </ul>
                        
                        <ul class="list-group well" id="adminpanel" style="display:none">
                        <!-- Menu with ADMIN access begins -->
                            <li class="list-group-item" id="addmemberLink">
                                <a class="notop" href="javascript:void(0)">
                                    Add Member
                                </a>
                            </li>
                            <li class="list-group-item" id="editmembersLink">
                                <a class="notop" href="javascript:void(0)">
                                    Edit Members
                                </a>
                            <li class="list-group-item" id="createsocietyeventLink">
                                <a class="notop" href="javascript:void(0)">
                                    Add Society Event
                                </a>
                            </li>
                            <li class="list-group-item" id="editsocietyeventsLink">
                                <a class="notop" href="javascript:void(0)">
                                    Edit Society Events
                                </a>
                            </li>
                        <!-- Menu with ADMIN access ends -->
                        </ul>
                    </div>
                    
                    <!-- Committee list panel definition begins -->
                    <div class="col-md-6 col-md-offset-1" >
                        <div id="welcome" class="text-center well">
                            <h1>Welcome to Nexperia Golf Society Home Page!</h1>
                        </div>
                        <div id="committeecontent" style="display:none">
                            <div class="well  text-center" >  
                                <h1>The Committee</h1> 
                                <h4>Below is a listing of the current Society Committee. If you have any queries about your current handicap or any other specific enquiries then please direct them to the relevant committee member.</h4>
                            </div>

                            <table id="committeetable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Members Name</th>
                                        <th>Position</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr></tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Committee list panel definition ends -->
                        
                        <!-- Members list panel definition begins -->
                        <div id="membershiplistingcontent" style="display:none">
                            <div class="well  text-center" >
                                <h1>Membership Listing</h1>
                                <h4>Below is a current list of Members handicaps and contact information. If you have any queries about your current handicap or if you need to change your contact information then please get in touch with one of the society organisers. To view a members handicap record click on the persons name. For a group email list, scroll down to the bottom of the page. </h4>
                            </div>

                            <table id="memberstable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Members Name</th>
                                        <th>Handicap (Exact)</th>
                                        <th>Handicap (Playing)</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr></tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Members list panel definition ends -->
                        
                        <!-- Society events panel definition begins -->
                        <div id="societyeventscontent" style="display:none">
                            <div class="well  text-center" >
                                <h1>Society events</h1>
                                <h4></h4>
                            </div>

                            <table id = "societyeventstable" class=  "table table-hover">
                                <thead>
                                </thead>
                                <tbody>
                                    <tr></tr>
                                </tbody>
                            </table>
                            
                            <div class = "text-center well">
                                <div class="list-group" id="eventlist">
                                </div> 
                                <button type="button" class="btn btn-primary btn-arrow-left" style = "margin-bottom: 20px" id = "eventprevyearbtn">Prev</button>
                                <button type="button" class="btn btn-primary" style = "margin-left: 20px; margin-right: 20px; margin-bottom: 20px" id = "eventlistbtn">2017</button>
                                <button type="button" class="btn btn-primary btn-arrow-right" style = "margin-bottom: 20px" id = "eventnextyearbtn">Next</button>
                            </div>
                            
                            
                        </div>
                        <!-- Society events panel definition ends -->
                        
                    <!-- Logged user panel definitions begin -->
                        <!-- Account Settings panel definition begins -->
                        <div id = "accountsettings" style = "display:none">
                            <div class = "well  text-center" >  
                                <h1>Account Settings</h1>
                            </div>

                            <div class = "well" id = "changedetailspanel">
                                <label style = "margin-top:20px" for="accountusername">
                                    Login:
                                </label>
                                <input type="text" class="form-control" id="accountusername">

                                <label style = "margin-top:20px" for="accountname">
                                    Name:
                                </label>
                                <input type="text" class="form-control" id="accountname">

                                <label style = "margin-top:20px" for="accountemail">
                                    Email:
                                </label>
                                <input type="text" class="form-control" id="accountemail">

                                <label style = "margin-top:20px" for="accountphone">
                                    Phone:
                                </label>
                                <input type="text" class="form-control" id="accountphone">                                
                                <button id="updateaccountdetails" style = "margin-top:20px" type="button" class="btn btn-primary btn-block">
                                    Apply changes
                                </button>
                            </div>

                            <div class = "well" id = "changepasswordpanel">
                                <label style = "margin-top:20px" for="accountcurrentpassword">
                                    Current password:
                                </label>
                                <input type="password" class="form-control" id="accountcurrentpassword">

                                <label style = "margin-top:20px" for="accountnewpassword">
                                    New password:
                                </label>
                                <input type="password" class="form-control" id="accountnewpassword">

                                <label style = "margin-top:20px" for="accountrepeatnewpassword">
                                    Repeat new password:
                                </label>
                                <input type="password" class="form-control" id="accountrepeatnewpassword">

                                <button id="changeaccountpassword" style = "margin-top:20px" type="button" class="btn btn-primary btn-block">
                                    Change password
                                </button>
                            </div>            
                        </div>
                        <!-- Account Settings panel definition ends -->
                        
                        <!-- User Stats panel definition begins -->
                        <div id="userstats" style="display:none">
                            <div class="well  text-center" >  
                                <h1>User Stats</h1> 
                            </div>
                        </div>
                        <!-- User Stats panel definition ends -->
                    <!-- Logged user panel definitions end -->
                        
                    <!-- ADMIN  panels definitions begin -->
                        <!-- Add member panel definition begins -->
                        <div id="addmember" style="display:none">
                            <div class="well  text-center" >  
                                <h1>Add member</h1> 
                            </div>

                            <form class="form well" role="form" method="post" action="addmemberform" accept-charset="UTF-8" id="addmemberpanel">
                                <div class="form-group">
                                    <label for="addmemberusername">
                                        Username:
                                    </label>
                                    <input type="text" class="form-control" id="addmemberusername" placeholder="Username" required>
                                </div>

                                <div class="form-group">
                                    <label for="addmembername">
                                        Member name:
                                    </label>
                                    <input type="text" class="form-control" id="addmembername" placeholder="Albert Einstein" required>
                                </div>

                                <div class="form-group">
                                    <label for="addmemberhandicap">
                                        Handicap:
                                    </label>
                                    <input type="text" class="form-control" id="addmemberhandicap" placeholder="20" required>
                                </div>

                                <div class="form-group">
                                    <button id="addmemberbtn" type="button" class="btn btn-primary btn-block">
                                        Add member
                                    </button>
                                </div>
                            </form>
                        </div>
                        <!-- Add member panel definition ends -->
                        
                        <!-- Edit members panel definition begins -->
                        <div id="editmembers" style="display:none">
                            <div class="well  text-center" >  
                                <h1>Edit members</h1>     
                            </div>

                            <div class="list-group" id = "editmemberslist">
                            </div> 
                        </div>
                        <!-- Edit members panel definition ends -->
                        
                        <!-- Edit Society Events definition begins -->
                        <div id="editsocietyevents" style="display:none">
                            <div class="well  text-center" >  
                                <h1>Edit Society Events</h1>     
                            </div>
                            <div class = "well" id = "editeventpanel">
                                
                                <button id="editeventbtn" type="button" style = "margin-bottom:20px" class="btn btn-danger btn-block">
                                    Delete Event
                                </button>
                                
                                <label style = "margin-top:20px" for="editeventname">
                                    Event name:
                                </label>
                                <input type="text" class="form-control" id="editeventname">

                                <label style = "margin-top:20px" for="editeventcourse">
                                    Course:
                                </label>
                                <input type="text" class="form-control" id="editeventcourse">

                                <label style = "margin-top:20px" for="editeventpostcode">
                                    Post Code of Course:
                                </label>
                                <input type="text" class="form-control" id="editeventpostcode">
                                
                                <label style = "margin-top:20px" for="editeventclub">
                                    Club or Course Website:
                                </label>
                                <input type="text" class="form-control" id="editeventclub">

                                <div class="form-group">
                                    <label style = "margin-top:20px" for="editeventdate">
                                        Date of Event:
                                    </label>
                                    <div class='input-group date' data-date="" data-date-format="dd MM yyyy" id='editeventdate'>
                                        <input type='text' class="form-control" readonly id="editneweventdate">
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>

                                <label style = "margin-top:20px" for="editeventprice">
                                    Price per Head:
                                </label>
                                <input type="text" class="form-control" id="editeventprice">    
                                
                                <label style = "margin-top:20px" for="editeventwhatincluded">
                                    What's included:
                                </label>
                                <input type="text" class="form-control" id="editeventwhatincluded">
                                
                                <label style = "margin-top:20px" for="editeventmaxparticipants">
                                    Max Number of Participants:
                                </label>
                                <input type="text" class="form-control" id="editeventmaxparticipants">

                                <label style = "margin-top:20px" for="editevenorganiser">
                                    Main Event Organiser:
                                </label>
                                <input type="text" class="form-control" id="editevenorganiser">                                
                                <div class="form-group">
                                    <label style = "margin-top:20px" for="editeventteatime">
                                        First Tea time:
                                    </label>
                                    <div class='input-group date form-time' data-date="" data-date-format="hh:ii" id='editeventteatime'>
                                        <input type='text' class="form-control" readonly>
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-time"></span>
                                        </span>
                                    </div>
                                </div>      
                                
                                <div class="form-group">
                                    <label for="editeventnotes">Notes:</label>
                                    <textarea class="form-control" rows="5" id="editeventnotes"></textarea>
                                </div> 
                                
                                <button id="editeventbtn" type="button" style = "margin-top:20px" class="btn btn-primary btn-block">
                                    Apply changes
                                </button>
                            </div>
                            <div class = "text-center well">
                                <div class="list-group" id="editeventlist">
                                </div> 
                                <button type="button" class="btn btn-primary btn-arrow-left" style = "margin-bottom: 20px" id = "editeventprevyearbtn">Prev</button>
                                <button type="button" class="btn btn-primary" style = "margin-left: 20px; margin-right: 20px; margin-bottom: 20px" id = "editeventlistbtn">2017</button>
                                <button type="button" class="btn btn-primary btn-arrow-right" style = "margin-bottom: 20px" id = "editeventnextyearbtn">Next</button>
                            </div>
                        </div>
                        <!-- Edit Society Event panel definition ends -->
                        
                        <!-- Add society event panel definition begins -->
                        <div id="createsocietyevent" style="display:none">
                            <div class="well  text-center" >  
                                <h1>Publish a new event</h1> 
                            </div>

                            <div class = "well" id = "basicaddeventpanel">
                                <label style = "margin-top:20px" for="addeventname">
                                    Event name:
                                </label>
                                <input type="text" class="form-control" id="addeventname">

                                <label style = "margin-top:20px" for="addeventcourse">
                                    Course:
                                </label>
                                <input type="text" class="form-control" id="addeventcourse">

                                <label style = "margin-top:20px" for="addeventpostcode">
                                    Post Code of Course:
                                </label>
                                <input type="text" class="form-control" id="addeventpostcode">
                                
                                <label style = "margin-top:20px" for="addeventclub">
                                    Club or Course Website:
                                </label>
                                <input type="text" class="form-control" id="addeventclub">

                                <div class="form-group">
                                    <label style = "margin-top:20px" for="addeventdate">
                                        Date of Event:
                                    </label>
                                    <div class='input-group date' data-date="" data-date-format="dd MM yyyy" id='addeventdate'>
                                        <input type='text' class="form-control" readonly id="neweventdate">
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>

                                <label style = "margin-top:20px" for="addeventprice">
                                    Price per Head:
                                </label>
                                <input type="text" class="form-control" id="addeventprice">    
                                
                                <label style = "margin-top:20px" for="addeventwhatincluded">
                                    What's included:
                                </label>
                                <input type="text" class="form-control" id="addeventwhatincluded">
                                
                                <label style = "margin-top:20px" for="addeventmaxparticipants">
                                    Max Number of Participants:
                                </label>
                                <input type="text" class="form-control" id="addeventmaxparticipants">

                                <label style = "margin-top:20px" for="addevenorganiser">
                                    Main Event Organiser:
                                </label>
                                <input type="text" class="form-control" id="addevenorganiser">                                
                                <div class="form-group">
                                    <label style = "margin-top:20px" for="addeventteatime">
                                        First Tea time:
                                    </label>
                                    <div class='input-group date form-time' data-date="" data-date-format="hh:ii" id='addeventteatime'>
                                        <input type='text' class="form-control" readonly>
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-time"></span>
                                        </span>
                                    </div>
                                </div>      
                                
                                
                                <div class="form-group">
                                    <label for="addeventnotes">Notes:</label>
                                    <textarea class="form-control" rows="5" id="addeventnotes"></textarea>
                                </div> 
                                
                                <button id="addeventbtn" type="button" style = "margin-top:20px" class="btn btn-primary btn-block">
                                    Publish new event
                                </button>
                            </div>
                        </div>
                        <!-- Add society event panel definition ends -->
                    <!-- ADMIN  panels definitions ends -->
                    </div>
                </div>
            </div>

            <!-- About content-->
            <div class="container" id="about">
                <div class="row">
                </div>
            </div>
        
        </div>
        
        <footer>
            <!-- Footer - Contact content -->
            <div id="footer-placeholder">
            </div>
        </footer>
        
        <script>  // scripts for html menus, carrousel and date picking support 
            $(document).ready(function(){    
                
                 //General access links:
                
                $("#glofmenu").on("click", "#committee", function(event){;  // show committee 
                     hideAll();
                     $("#committeecontent").show();
                });
                
                $("#glofmenu").on("click", "#membershiplisting", function(event){   // show members list
                    hideAll();
                    $("#membershiplistingcontent").show();
                    for(let i = 0, length = MEMBERS.length; i < length; i++){
                        console.log(MEMBERS[i]);
                    }   
                });  
                
                $("#glofmenu").on("click", "#societyeventslisting", function(event){;  // show society events 
                     hideAll();
                     $("#societyeventscontent").show();
                });
                
                //Logged user links (from top menu):
                
                $("#accountsettingsLink").on("click", function(event){ // show logged user account settings  
                    hideAll();
                    $("#accountusername").val(user.data.username);
                    $("#accountname").val(user.data.name);
                    $("#accountphone").val(user.data.phone);
                    $("#accountemail").val(user.data.email);
                    $("#accountsettings").show();
                });

                $("#userstatsLink").on("click", function(event){    // show logged user statistics
                    hideAll();
                    $("#userstats").show();
                });
                
                //Admin menu links:
                
                $("#addmemberLink").on("click", function(event){    // show add member panel 
                    hideAll();
                    $("#addmember").show();
                });

                $("#editmembersLink").on("click", function(event){  // show edits member panel
                    hideAll();
                    $("#editmembers").show();
                });
                
                $("#editsocietyeventsLink").on("click", function(event){  // show edits member panel
                    hideAll();
                    $("#editsocietyevents").show();
                });
                
                $("#createsocietyeventLink").on("click" , function(event){  // show add event panel
                    hideAll();
                    $("#createsocietyevent").show();
                });    
                
                // carrousel and date/time picking
                
                $('#myCarousel').carousel({ // change carrousel slide each 10s
                    interval: 10000
                });
                    
                $('#addeventdate').datetimepicker({ // fancy date picking for add society event panel
                    weekStart: 1,
                    todayBtn:  1,
                    autoclose: 1,
                    todayHighlight: 1,
                    startView: 2,
                    minView: 2,
                    forceParse: 0
                });
                
                $('#addeventteatime').datetimepicker({ // fancy tea-time picking for add society event panel
                    autoclose: 1,
                    pickerPosition: "top-right",
                    todayHighlight: 1,
                    startView: 1,
                    minView: 0,
                    maxView: 1,
                    forceParse: 0
                });
                
                $('#editeventdate').datetimepicker({ // fancy date picking for add society event panel
                    weekStart: 1,
                    todayBtn:  1,
                    autoclose: 1,
                    todayHighlight: 1,
                    startView: 2,
                    minView: 2,
                    forceParse: 0
                });
                
                $('#editeventteatime').datetimepicker({ // fancy tea-time picking for add society event panel
                    autoclose: 1,
                    pickerPosition: "top-right",
                    todayHighlight: 1,
                    startView: 1,
                    minView: 0,
                    maxView: 1,
                    forceParse: 0
                });                
                
                // usefull functions:
                
                $('a .notop').click(function(e){    // do not go to the top of page after clicking .notop link
                    e.preventDefault();            
                });                
                
                function hideAll(){     // hide all panels and clear secure data
                    $("#welcome").hide();
                    $("#committeecontent").hide();
                    $("#membershiplistingcontent").hide();
                    $("#accountsettings").hide();
                    $("#userstats").hide();
                    $("#addmember").hide();
                    $("#editmembers").hide();
                    $("#createsocietyevent").hide();
                    $("#societyeventscontent").hide();
                    $("#editsocietyevents").hide();
                    clearSecureData();
                }
                
                function clearSecureData(){ // clear secure data like password in edit boxes
                    $("#accountrepeatnewpassword").val("");
                    $("#accountnewpassword").val("");
                    $("#accountcurrentpassword").val("");
                }
            });  
        </script>
        
        <script src="https://cdn.socket.io/socket.io-1.4.5.js">
        </script> 
        
        <script>    // scripts to handle server-client communication and update data
            let User = function(){
                let self = {};
                self.loggedin = false;
                return self;
            }
            
            var user = User();
            const MEMBERS = [];
            const SOCIETY_EVENTS = [];
            let societyEventsYear = 0;
            let societyEditEventsYear = 0;
            
            let committee = [];
            var socket = io(); 
            var committeDataLoaded = false;
            
            socket.emit('dataRequest', "membershiplisting");  
            socket.emit('dataRequest', "societyeventslisting"); 

            socket.on('memberAdded', function(data){
                MEMBERS.push(data);
                updateMemberList();
                bootbox.alert({message: "Member has been added.", backdrop: true});
            });

            socket.on('memberEdited', function(data){
                updateMember(data);
                updateMemberList();
                bootbox.alert({message: "Member has been edited.", backdrop: true});
            });          
            
            socket.on('memberDeleted', function(data){
                deleteMember(data);
                updateMemberList();
                bootbox.alert({message: "Member has been deleted.", backdrop: true});
            });   
            
            socket.on('usernametaken', function(data){
                bootbox.alert({message: "Username already taken.", backdrop: true});
            });
            
            socket.on('membershiplistingData', function(data){ 
                $(document).ready(function() {
                    for(let i = 0, length = data.length; i < length; i++){
                        MEMBERS.push(data[i]);        
                        updateMemberPanels(i);
                    }
                    committee = getCommittee();
                    for(let i = 0, length = committee.length; i < length; i++){
                        $('#committeetable tr:last').after('<tr><td>'+committee[i]["name"]+'</td><td>'+committee[i]["position"]+'</td><td>'+committee[i]["email"]+'</td><td>'+committee[i]["phone"]+'</td></tr>');       
                    }
                });                      
            }); 
            
            socket.on('societyeventslistingData', function(data){ 
                $(document).ready(function() {
                    for(let i = 0, length = data.length; i < length; i++){
                        SOCIETY_EVENTS.push(data[i]);        
                        //updateSocietyeventPanels(i);
                    }
                    
                    let index = getLastEventIndex();
                    
                    updateSocietyEventTable(index);
                    updateEditSocietyEventForm(index);
                    
                    societyEventsYear = SOCIETY_EVENTS[index]["year"];
                    societyEditEventsYear = SOCIETY_EVENTS[index]["year"];
                    
                    updateSocietyEventList(SOCIETY_EVENTS[index]["year"]);
                    updateEditSocietyEventList(SOCIETY_EVENTS[index]["year"]);
                    
                });                      
            }); 
            
            socket.on('passwordCorrect', function(data){
                if(($("#accountnewpassword").val()) === ($("#accountrepeatnewpassword").val())){
                    socket.emit('changePassword', {username: user.data.username, password: $('#accountnewpassword').val()});
                } else{
                    bootbox.alert({message: "New password doesn't match repeat password. Try again.", backdrop: true});
                }
            });
            
            socket.on('passwordIncorrect', function(data){
                bootbox.alert({message: "Current password incorrect!", backdrop: true});
            });
            
            socket.on('passwordChanged', function(data){
                bootbox.alert({message: "Password was changed!", backdrop: true});
            });
            
            socket.on('userDetailsChanged', function(data){     
                let member = getMember(user.data.username);
                
                member["username"] = data.username;
                member["name"] = data.name;
                member["email"] = data.email;
                member["phone"] = data.phone;
                
                user.data.name = member["name"];
                user.data.username = member["username"];
                user.data.email = member["email"];
                user.data.phone = member["phone"];
                
                updateMemberList();
                
                $("#accountusername").val(user.data.username);
                $("#accountname").val(user.data.name);
                $("#accountemail").val(user.data.email);
                $("#accountphone").val(user.data.phone);
                    
                showUserTab();
                
                bootbox.alert({message: "User details were changed!", backdrop: true});
            });
            
            socket.on('signInResponse', function(data){
                if(data.success){
                    user.loggedin = true;
                    user["data"] = data;
                    
                    if(data.username !== "admin"){
                        let member = (getMember(data.username));
                        user.data.name = member["name"];
                        user.data.phone = member["phone"];
                        user.data.email = member["email"];
                        $("#changedetailspanel").show();
                    } else{
                        $("#changedetailspanel").hide();
                    }
                       
                   showUserTab();
                    
                   if(user["data"].admin === "true"){
                       $("#adminpanel").show();
                   }    
                }
            });
            
            $(document).ready(function() {
                $("#loginbtn").on("click", function(event){
                    socket.emit('signIn', {username: $('#loginUsername').val(), password: $('#loginPassword').val()} );
                });
                
                $("#addmemberbtn").on("click", function(event){
                    if(checkMemberFormValidation()){
                        socket.emit('addMember', {username:$("#addmemberusername").val(), password: $("#addmemberusername").val(), name: $("#addmembername").val(), 
                        handicapExact:$("#addmemberhandicap").val(), email:"", admin:"false", handicapPlaying:$("#addmemberhandicap").val(), phone:"", committee: "false"});
                    }
                });
                
                $("#addeventbtn").on("click", function(event){
                    console.log($("#neweventdate").val());
                });
                
                $("#editmemberslist").on("click", "a", function(event){
                    let id = $(this).attr('id');
                    let propertiesId = "#member"+id;
                    
                    $(propertiesId).slideToggle();
                });
                
                $("#eventlist").on("click", "a", function(event){
                    let id = $(this).attr('id');
                    
                    updateSocietyEventTable(id);
                });
                
                $("#eventnextyearbtn").on("click", function(event){
                    console.log("Year "+societyEventsYear+"");
                    if(societyEventsYear < SOCIETY_EVENTS[getLastEventIndex()]["year"]){
                        societyEventsYear++;
                        updateSocietyEventList(societyEventsYear);
                    }
                });

                $("#eventprevyearbtn").on("click", function(event){
                    console.log("Year p"+getOldestEventIndex());
                    if(societyEventsYear > SOCIETY_EVENTS[getOldestEventIndex()]["year"]){
                        societyEventsYear--;
                        updateSocietyEventList(societyEventsYear);
                    }
                });
                
                $("#editeventnextyearbtn").on("click", function(event){
                    console.log("Year "+societyEditEventsYear+"");
                    if(societyEditEventsYear < SOCIETY_EVENTS[getLastEventIndex()]["year"]){
                        societyEditEventsYear++;
                        updateEditSocietyEventList(societyEditEventsYear);
                    }
                });

                $("#editeventprevyearbtn").on("click", function(event){
                    console.log("Year p"+getOldestEventIndex());
                    if(societyEditEventsYear > SOCIETY_EVENTS[getOldestEventIndex()]["year"]){
                        societyEditEventsYear--;
                        updateEditSocietyEventList(societyEditEventsYear);
                    }
                });
                
                $("#changepasswordpanel").on("click","button",function(event){
                    
                    socket.emit('checkCurrentPassword', {username: user.data.username, password: $("#accountcurrentpassword").val()});
                });
                
                $("#changedetailspanel").on("click","button",function(event){
                    if(checkUserDetailsFormValidation()){
                        socket.emit('changeUserDetails',{username: $("#accountusername").val(), oldusername: user.data.username, name: $("#accountname").val(), phone: $("#accountphone").val(), email: $("#accountemail").val()});   
                    }                    
                });
                
                $("#editmemberslist").on("click", "button", function(event){
                    let username = "";
                    let name = "";
                    let handicap = "";
                     
                    $(this).parent().find('input').each(function(){
                        switch($(this).attr('id')){
                            case "editmemberusername": 
                                username = $(this).val();
                            break;
                            case "editmembername": 
                                name = $(this).val();
                            break;
                            case "editmemberhandicap":
                                handicap = $(this).val();
                            break;
                        }    
                    });
                     
                    if(($(this).attr('id')) == "editmember"){
                        if(checkEditFormValidation($(this))){
                            socket.emit('editMember',{username: username, name: name, handicapExact: handicap});
                        }
                    } else{
                        bootbox.confirm("Are you sure to delete "+username+" ?" , function(result){
                            if(result){
                                socket.emit('deleteMember',{username: username, name: name, handicapExact: handicap});  
                            }
                        }); 
                    }
                });
            
                $("#logoutLink").on("click" , function(event){
                    user.loggedin = false;
                    
                    $("#login-menu").show();
                    $("#loggedin").hide();
                    $("#adminpanel").hide();
                    $("#accountsettings").hide();
                    $("#userstats").hide();
                    $("#addmember").hide();
                    $("#editmembers").hide();
                    $("#createsocietyevent").hide();
                });
            });
            
            function showUserTab(){
                $("#login-menu").hide();
                $("#loggedin").show();
                $("#userMenuTitle").text(user["data"].username);
            }
            
            function updateMember(member){   
                for(let i = 0, length = MEMBERS.length; i < length; i++){
                    if(MEMBERS[i]["username"] === member.username){
                        MEMBERS[i]["name"] = member.name;
                        MEMBERS[i]["handicapExact"] = member.handicapExact;
                        break;
                    }
                }
            }
            
            function getMember(username){
                for(let i = 0, length = MEMBERS.length; i < length; i++){
                    if(MEMBERS[i]["username"] === username){
                        return MEMBERS[i];
                        break;
                    }
                }
            }
            
            function deleteMember(member){    
                for(let i = 0, length = MEMBERS.length; i < length; i++){
                    if(MEMBERS[i]["username"] === member.username){    
                        MEMBERS.splice(i, 1);;
                        break;
                    }
                }  
            }            
            
            function updateMemberList(){
                $('#memberstable').find('tbody').empty();
                $('#editmemberslist').empty();      
                
                for(let i =0, length = MEMBERS.length; i < length; i++){     
                    updateMemberPanels(i);
                }
            }
            
            // Function to check letters and numbers  
            function alphanumeric(inputtxt, plusSpace){  
                let letterNumber;
                    
                if(plusSpace === true){
                    letterNumber = /^[0-9a-zA-Z]+$/;
                    letterNumber = /^[\w\-\s]+$/;
                } else{
                    letterNumber = /^[\w\-\s]+$/;
                    letterNumber = /^[0-9a-zA-Z]+$/;
                }
                
                if(inputtxt.match(letterNumber)){  
                    return true;  
                } else {    
                    return false;   
                }  
            }
            
            function validateEmail(email) {
                let re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            }
            
            function checkEditFormValidation(btn){
                let name = "";
                let handicap = "";    
                
                btn.parent().find('input').each(function(){
                    switch($(this).attr('id')){
                        case "editmembername": 
                            name = $(this).val();
                            break;
                        case "editmemberhandicap" :
                            handicap = $(this).val();
                            break;
                        }        
                }); 
                
                if(alphanumeric(name, true) && name.length > 0){
                    if($.isNumeric(handicap)){
                        return true;
                    } else{
                        bootbox.alert({message: "Handicap data incorrect. Only numbers allowed.", backdrop: true});
                        return false;
                    }
                } else{
                    bootbox.alert({message:"Name data incorrect. Only letters, numbers and space allowed.", backdrop: true});
                    return false;
                }
            }
            
            function checkUserDetailsFormValidation(){
                if(alphanumeric($("#accountusername").val(), false) && $("#accountusername").val().length > 0 ){
                    if(alphanumeric($("#accountname").val(), true) && $("#accountname").val().length > 0 ){
                        if($.isNumeric($("#accountphone").val()) || $("#accountphone").val() == ""){
                            if(validateEmail(($("#accountemail").val())) || $("#accountemail").val() == ""){
                                return true;
                            } else{
                                bootbox.alert({message: "Email data incorrect. Only email format allowed or leave it blank.", backdrop: true});
                                return false;
                            }
                        } else{
                            bootbox.alert({message: "Phone data incorrect. Only numbers allowed or leave it blank.", backdrop: true});
                            return false;
                        }
                     } else{
                        bootbox.alert({message:"Name data incorrect. Only letters, numbers and space allowed.", backdrop: true});
                        return false;
                     }
                } else{
                    bootbox.alert({message: "Username data incorrect. Only letters and numbers allowed.", backdrop: true});
                    return false;   
                }
            }
            
            function checkMemberFormValidation(){
                if(alphanumeric($("#addmemberusername").val(), false) && $("#addmemberusername").val().length > 0 ){
                    if(alphanumeric($("#addmembername").val(), true) && $("#addmembername").val().length > 0 ){
                        if($.isNumeric($("#addmemberhandicap").val())){
                            return true;
                        } else{
                            bootbox.alert({message: "Handicap data incorrect. Only numbers allowed.", backdrop: true});
                            return false;
                        }
                    } else{
                        bootbox.alert({message:"Name data incorrect. Only letters, numbers and space allowed.", backdrop: true});
                        return false;
                        }
                } else {
                    bootbox.alert({message: "Username data incorrect. Only letters and numbers allowed.", backdrop: true});
                    return false;
                }
            }
            
            function getCommittee(){
                let arr =[];
                
                for(let i = 0, length = MEMBERS.length; i < length; i++){
                    if(MEMBERS[i]["committee"] == "true"){
                        arr.push(MEMBERS[i]);
                    }
                }
                return arr;
            }
            
            function updateMemberPanels(i){
                $('#memberstable').find('tbody').append('<tr><td>'+MEMBERS[i]["name"]+'</td><td>'+MEMBERS[i]["handicapExact"]+'</td><td>'+Math.round(Number(MEMBERS[i]["handicapExact"]))+'</td><td>'+MEMBERS[i]["email"]+'</td><td>'+MEMBERS[i]["phone"]+'</td></tr>');
                        
                $('#editmemberslist').append('<a href="javascript:void(0)" class="list-group-item notop list-group-item-info" id="'+i+'">'+MEMBERS[i]["name"]+'</a><ul class="list-group well" style="display:none" id="member'+i+'"></ul><br>');
                        
                //edit panel - adding members information
                        
                $("#member"+i).append('<button id="deletemember" type="button" style="margin-top:20px" class="btn btn-danger btn-block">Delete Member</button>');                        
                        
                $("#member"+i).append('<label for="editmemberusername" style="margin-top:20px">Username:</label><input type="text" class="form-control list-group-item" id="editmemberusername" placeholder="'+MEMBERS[i]["username"]+'" value="'+MEMBERS[i]["username"]+'" readonly>');
                        
                $("#member"+i).append('<label for="editmembername" style="margin-top:20px">Member name:</label><input type="text" class="form-control list-group-item" id="editmembername" placeholder="'+MEMBERS[i]["name"]+'" value="'+MEMBERS[i]["name"]+'">');
                        
                $("#member"+i).append('<label for="editmemberhandicap" style="margin-top:20px">Handicap:</label><input type="text" class="form-control list-group-item" id="editmemberhandicap" placeholder="'+MEMBERS[i]["handicapExact"]+'"  value="'+MEMBERS[i]["handicapExact"]+'">');
                        
                $("#member"+i).append('<button id="editmember" type="button" style="margin-top:20px" class="btn btn-primary btn-block">Apply changes</button>');
            }
            
            
            function updateSocietyEventTable(index){
                
                $('#societyeventstable').find('tbody').empty();
                $('#societyeventstable').find('tbody').append('<tr><td>Event Name:</td><td align="center">'+SOCIETY_EVENTS[index]["name"]+'</td></tr>'+'<tr><td>Course:</td><td align="center">'+SOCIETY_EVENTS[index]["course"]+'</td></tr>'+'<tr><td>Post Code of Course:</td><td align="center">'+SOCIETY_EVENTS[index]["postcode"]+'</td></tr>'+'<tr><td>Club or Course Website:</td><td align="center">'+SOCIETY_EVENTS[index]["website"]+'</td></tr>'+'<tr><td>Date of Event:</td><td align="center">'+SOCIETY_EVENTS[index]["day"]+'/'+SOCIETY_EVENTS[index]["month"]+'/'+SOCIETY_EVENTS[index]["year"]+'</td></tr>'+'<tr><td>First Tea Time:</td><td align="center">'+SOCIETY_EVENTS[index]["firstteatime"]+'</td></tr>'+'<tr><td>Price per Head:</td><td align="center">'+SOCIETY_EVENTS[index]["price"]+'</td></tr>'+"<tr><td>What's included:</td><td align='center'>"+SOCIETY_EVENTS[index]["included"]+'</td></tr>'+'<tr><td>Max Number of Participants:</td><td align="center">'+SOCIETY_EVENTS[index]["maxplayers"]+'</td></tr>'+'<tr><td>Main Event Organiser:</td><td align="center">'+SOCIETY_EVENTS[index]["organiser"]+'</td></tr>'+'<tr><td>Notes:</td><td align="center">'+SOCIETY_EVENTS[index]["notes"]+'</td></tr>');
            }
            
            function updateEditSocietyEventForm(index){
                $('#editeventname').val(SOCIETY_EVENTS[index]["name"]);
                $('#editeventcourse').val(SOCIETY_EVENTS[index]["course"]);
                $('#editeventpostcode').val(SOCIETY_EVENTS[index]["postcode"]);
                $('#editeventclub').val(SOCIETY_EVENTS[index]["website"]);
                //$('#editeventdate').val(SOCIETY_EVENTS[index]["day"]+'/'+SOCIETY_EVENTS[index]["month"]+'/'+SOCIETY_EVENTS[index]["year"]);
                $('#editeventprice').val(SOCIETY_EVENTS[index]["price"]);
                $('#editeventwhatincluded').val(SOCIETY_EVENTS[index]["included"]);
                $('#editeventmaxparticipants').val(SOCIETY_EVENTS[index]["maxplayers"]);
                
                var options = {
                    defaultDate: 'aa',
                };
                $('#editeventdate').datetimepicker("update", new Date(11,11,11,11,11,11,11));
                $('#editeventteatime').datetimepicker("update", new Date(11,11,11,11,11,11,11));
                
                //$('#editeventteatime').val(SOCIETY_EVENTS[index]["firstteatime"]);
                $('#editevenorganiser').val(SOCIETY_EVENTS[index]["organiser"]);
                $('#editeventnotes').val(SOCIETY_EVENTS[index]["notes"]);
            }
            
            function updateSocietyEventList(year){
                
                let arr = [];
                $('#eventlist').empty();
                console.log("update event");
                for(let i=0, length = SOCIETY_EVENTS.length; i < length; i++){
                    if(SOCIETY_EVENTS[i]['year'] == year){
                       $('#eventlist').append('<a class = "notop list-group-item text-center list-group-item-info" href="javascript:void(0)" id="'+i+'" >'+SOCIETY_EVENTS[i]["name"]+'</a>');
                    }
                }
                
                $('#eventlistbtn').text(year);
            }
            
            function updateEditSocietyEventList(year){
                let arr = [];
                $('#editeventlist').empty();
                console.log("update event");
                for(let i=0, length = SOCIETY_EVENTS.length; i < length; i++){
                    if(SOCIETY_EVENTS[i]['year'] == year){
                       $('#editeventlist').append('<a class = "notop list-group-item text-center list-group-item-info" href="javascript:void(0)" id="'+i+'" >'+SOCIETY_EVENTS[i]["name"]+'</a>');
                    }
                }
                
                $('#editeventlistbtn').text(year);
            }
            
            function getLastEventIndex(){
                let arr = [];
                
                for(let i=0, length = SOCIETY_EVENTS.length; i < length; i++){
                    arr.push(SOCIETY_EVENTS[i]['year']+SOCIETY_EVENTS[i]['month']+SOCIETY_EVENTS[i]['day']);
                }
                
                return indexOfMax(arr);
                
            }
            
            function getOldestEventIndex(){
                let arr = [];
                
                for(let i=0, length = SOCIETY_EVENTS.length; i < length; i++){
                    arr.push(SOCIETY_EVENTS[i]['year']+SOCIETY_EVENTS[i]['month']+SOCIETY_EVENTS[i]['day']);
                }
                
                return indexOfMin(arr);
            }
            
            function indexOfMax(arr) {
                if (arr.length === 0) {
                    return -1;
                }

                let max = arr[0];
                let maxIndex = 0;

                for (let i = 1; i < arr.length; i++) {
                    if (arr[i] > max) {
                        maxIndex = i;
                        max = arr[i];
                    }
                }

                return maxIndex;
            }
            
            function indexOfMin(arr){
                if (arr.length === 0) {
                    return -1;
                }

                let index = 0;
                let value = arr[0];
                for (var i = 1; i < arr.length; i++) {
                  if (arr[i] < value) {
                    value = arr[i];
                    index = i;
                  }
                }
                
                return index;
            }
        </script> 
    </body>
</html>